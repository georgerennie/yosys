log -header "Test simple positive case"
log -push
read_verilog <<EOF
module top (
  input wire  [31:0] a,
  output wire  [63:0] y
);
  assign y = (a * 5140) / (257 * 2);
endmodule
EOF
equiv_opt -assert peepopt
design -load postopt
select -assert-none t:$div
design -reset
log -pop

log -header "Test negative case where div is kept"
log -push
design -reset
read_verilog <<EOF
module top (
  input wire signed [31:0] a,
  output wire signed [63:0] y,
  output wire probe
);
   wire [44:0] tmp = (a * 5140);
   assign probe = tmp[44];

  assign y = tmp[43:0] / (257 * 2);
endmodule
EOF
equiv_opt -assert peepopt
design -load postopt
select -assert-count 1 t:$div
design -reset
log -pop
